[template]
name = "Baserow Railway Deployment"
description = "Deploy Baserow with PostgreSQL and Redis on Railway"
version = "1.0.0"

[template.variables]
BASEROW_PUBLIC_URL = { default = "${{RAILWAY_PUBLIC_DOMAIN}}", description = "Public URL for Baserow" }
SECRET_KEY = { default = "${{secret(64)}}", description = "Secret key for Baserow" }

[template.build]
builder = "NIXPACKS"

[[template.services]]
name = "baserow"
source = "DockerImage"
dockerImage = "baserow/baserow:2.0.3"

[template.services.deploy]
healthcheckPath = "/api/_health/"
restartPolicyType = "ON_FAILURE"

[template.services.env]
BASEROW_PUBLIC_URL = "${{BASEROW_PUBLIC_URL}}"
SECRET_KEY = "${{SECRET_KEY}}"

[[template.services]]
name = "postgres"
source = "DockerImage"
dockerImage = "postgres:15"

[template.services.env]
POSTGRES_DB = "baserow"
POSTGRES_USER = "baserow"
POSTGRES_PASSWORD = "${{secret(32)}}"

[[template.services]]
name = "redis"
source = "DockerImage"
dockerImage = "redis:7-alpine"

[template.services.env]
REDIS_PASSWORD = "${{secret(32)}}"